# Auto-Switching LLM - Visual Flow Diagram

```
User Query
    |
    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Complexity Analyzer                   â”‚
â”‚   (/backend/utils/complexity_analyzer)  â”‚
â”‚                                         â”‚
â”‚   Analyzes:                             â”‚
â”‚   â€¢ Message length                      â”‚
â”‚   â€¢ Keywords & technical terms          â”‚
â”‚   â€¢ Code presence                       â”‚
â”‚   â€¢ Question complexity                 â”‚
â”‚   â€¢ Multi-part structure                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               |
               v
        Complexity Score
         (0-12+ scale)
               |
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    |                     |
    v                     v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Simple    â”‚      â”‚  Complex   â”‚
â”‚  Score 0-5 â”‚      â”‚  Score 6+  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       |                   |
       v                   v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ gpt-4o-mini â”‚      â”‚   gpt-4o    â”‚
â”‚   Fast &    â”‚      â”‚   High      â”‚
â”‚ Cheap       â”‚      â”‚   Quality   â”‚
â”‚             â”‚      â”‚             â”‚
â”‚ $0.15 input â”‚      â”‚ $2.50 input â”‚
â”‚ $0.60 outputâ”‚      â”‚ $10.0 outputâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       |                   |
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  v
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Chat Agent     â”‚
          â”‚  Creates agent  â”‚
          â”‚  with selected  â”‚
          â”‚  LLM            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   v
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   API Response  â”‚
          â”‚                 â”‚
          â”‚   + response    â”‚
          â”‚   + metadata    â”‚
          â”‚   + thought     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Example Flow: Simple Query

```
Input: "Hello, how are you?"
  â†“
Analyzer:
  â€¢ Word count: 4 (Score: 0)
  â€¢ Simple keyword: "hello" (Score: -1)
  â€¢ No code (Score: 0)
  â€¢ Total Score: 1
  â†“
Classification: SIMPLE
  â†“
Model Selected: gpt-4o-mini
  â†“
Response: "Hello! I'm doing well, thank you for asking..."
  â†“
Metadata: {
  "model": "gpt-4o-mini",
  "complexity": "simple",
  "score": 1
}
```

## Example Flow: Complex Query

```
Input: "Design a scalable microservices architecture for an 
       e-commerce platform with high availability. Include 
       load balancing, database sharding, and CI/CD pipeline."
  â†“
Analyzer:
  â€¢ Word count: 85 (Score: 3)
  â€¢ Expert keywords: "scalability", "microservices" (Score: 4)
  â€¢ Technical terms: "database", "CI/CD" (Score: 2)
  â€¢ Total Score: 11
  â†“
Classification: EXPERT
  â†“
Model Selected: gpt-4o
  â†“
Response: [Detailed architecture design with trade-offs...]
  â†“
Metadata: {
  "model": "gpt-4o",
  "complexity": "expert",
  "score": 11,
  "indicators": [
    "Long message (85 words)",
    "Expert keywords (2)",
    "Technical terms (4)"
  ]
}
```

## Cost Impact Visualization

```
WITHOUT Auto-Switching (1000 queries/day)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” $97.50/month
All on gpt-4o

WITH Auto-Switching (1000 queries/day)
â”â”â”â”â”â”â”â”â”â”â”â”â”â” $33.30/month
70% gpt-4o-mini â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ $9.75
30% gpt-4o      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ $23.55

SAVINGS: $64.20/month (66%)
```

## Query Distribution (Typical)

```
Query Types:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Greetings/Acknowledgments    â”‚ 20% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ Simple Questions             â”‚ 30% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ Explanations                 â”‚ 25% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ Code/Architecture            â”‚ 15% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ Advanced/Debugging           â”‚ 10% â”‚ â–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Model Selection:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ gpt-4o-mini                  â”‚ 70% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â”‚ gpt-4o                       â”‚ 30% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend                             â”‚
â”‚              (React + TypeScript)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP/SSE
                        v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FastAPI Backend                        â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  POST /api/chat                                  â”‚  â”‚
â”‚  â”‚    â†“                                             â”‚  â”‚
â”‚  â”‚  agents/chat_agent.py                           â”‚  â”‚
â”‚  â”‚    â”œâ”€â†’ get_smart_llm(message)                   â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€â†’ complexity_analyzer.py             â”‚  â”‚
â”‚  â”‚    â”‚     â”‚     â””â”€â†’ Analyze & Score              â”‚  â”‚
â”‚  â”‚    â”‚     â””â”€â†’ Select Model                       â”‚  â”‚
â”‚  â”‚    â”œâ”€â†’ create_agent(llm)                        â”‚  â”‚
â”‚  â”‚    â””â”€â†’ agent.invoke()                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          v                           v
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ OpenAI   â”‚              â”‚  Google  â”‚
    â”‚ API      â”‚              â”‚  Gemini  â”‚
    â”‚          â”‚              â”‚  API     â”‚
    â”‚gpt-4o-   â”‚              â”‚gemini-   â”‚
    â”‚mini / 4o â”‚              â”‚flash/pro â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Request/Response Flow

```
1. User sends message
   â†“
2. API receives request
   {
     "message": "Design a scalable API",
     "chat_id": "optional"
   }
   â†“
3. Chat Agent calls get_smart_llm()
   â†“
4. Complexity Analyzer evaluates message
   Score: 8, Complexity: COMPLEX
   â†“
5. LLM selection: gpt-4o
   Console: ğŸ§  Smart LLM Selection: gpt-4o (complexity: complex, score: 8)
   â†“
6. Agent processes with selected LLM
   â†“
7. Response returned with metadata
   {
     "response": "Here's a scalable architecture...",
     "chat_id": "chat_123",
     "thought_process": [...],
     "llm_metadata": {
       "auto_switched": true,
       "model": "gpt-4o",
       "complexity": "complex",
       "score": 8
     }
   }
```

## Complexity Scoring Breakdown

```
Score Components:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Factor              Weight    Example       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Length              0-3       >100 words=3  â”‚
â”‚ Questions           0-2       Multiple Q's  â”‚
â”‚ Code Presence       +3        Code blocks   â”‚
â”‚ Expert Keywords     +4        "scalability" â”‚
â”‚ Complex Keywords    +2        "explain"     â”‚
â”‚ Multi-part          +2        Numbered list â”‚
â”‚ Tech Terms          0-2       "API", "DB"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Threshold Mapping:
0â”€â”€â”€â”€â”€â”€2â”€â”€â”€â”€â”€â”€â”€â”€â”€5â”€â”€â”€â”€â”€â”€â”€â”€â”€8â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€12+
â”‚      â”‚         â”‚         â”‚           â”‚
SIMPLE  MODERATE  COMPLEX   EXPERT
â”‚               â”‚                   â”‚
gpt-4o-mini     â”‚     gpt-4o        â”‚
gemini-flash    â”‚     gemini-pro    â”‚
```

## File Structure

```
backend/
â”œâ”€â”€ agents/
â”‚   â””â”€â”€ chat_agent.py         [Uses get_smart_llm()]
â”œâ”€â”€ api/
â”‚   â””â”€â”€ main.py               [Handles llm_metadata]
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ llm.py                [get_smart_llm() function]
â”‚   â””â”€â”€ complexity_analyzer.py [New: Analysis logic]
â””â”€â”€ .env
    â”œâ”€â”€ LLM_PROVIDER=openai
    â”œâ”€â”€ AUTO_SWITCH_LLM=true
    â””â”€â”€ OPENAI_API_KEY=...
```

## Monitoring Dashboard (Conceptual)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Today's Model Usage                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  gpt-4o-mini:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   750      â”‚
â”‚  gpt-4o:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ             250      â”‚
â”‚                                            â”‚
â”‚  Total Queries: 1,000                      â”‚
â”‚  Avg Score: 4.2                            â”‚
â”‚  Cost Today: $1.11                         â”‚
â”‚  Projected Monthly: $33.30                 â”‚
â”‚  vs Fixed gpt-4o: $97.50                   â”‚
â”‚  Savings: $64.20 (66%)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Complexity Distribution                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Simple:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  50%      â”‚
â”‚  Moderate:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          30%      â”‚
â”‚  Complex:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                15%      â”‚
â”‚  Expert:    â–ˆâ–ˆ                     5%      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
